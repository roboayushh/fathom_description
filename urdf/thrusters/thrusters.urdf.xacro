<?xml version="1.0" ?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro">

  <!-- Thruster macro -->
  <xacro:macro name="thruster" params="name xyz rpy">
    <link name="${name}">
      <inertial>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <mass value="0.001"/>
        <inertia ixx="0.0005" ixy="0" ixz="0"
                 iyy="0.0005" iyz="0" izz="0.0005"/>
      </inertial>
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="file://$(find auv_description)/meshes/prop.dae" scale="1 1 1"/>
        </geometry>
      </visual>
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <cylinder length="0.000001" radius="0.000001"/>
        </geometry>
      </collision>
    </link>

    <joint name="${name}_joint" type="revolute">
      <origin xyz="${xyz}" rpy="${rpy}"/>
      <parent link="base_link"/>
      <child link="${name}"/>
      <axis xyz="1 0 0"/>
      <limit effort="1" velocity="1"/>
    </joint>
  </xacro:macro>

  <!-- Instantiate 8 thrusters -->
  <xacro:thruster name="thruster1" xyz="-0.890895 0.334385 0.528822" rpy="0 -1.300794 -0.928689"/>
  <xacro:thruster name="thruster2" xyz="-0.890895 -0.334385 0.528822" rpy="0 -1.300794 0.928689"/>
  <xacro:thruster name="thruster3" xyz="0.890895 0.334385 0.528822" rpy="0 -1.840798 0.928689"/>
  <xacro:thruster name="thruster4" xyz="0.890895 -0.334385 0.528822" rpy="0 -1.300794 -0.928689"/>
  <xacro:thruster name="thruster5" xyz="-0.412125 0.505415 0.129" rpy="0 0 0.785398"/>
  <xacro:thruster name="thruster6" xyz="-0.412125 -0.505415 0.129" rpy="0 0 -0.785398"/>
  <xacro:thruster name="thruster7" xyz="0.412125 0.505415 0.129" rpy="0 0 2.356194"/>
  <xacro:thruster name="thruster8" xyz="0.412125 -0.505415 0.129" rpy="0 0 -2.356194"/>

  <!-- thruster_plugin_macro.xacro -->
  <xacro:macro name="thruster_plugin" params="joint_name">
    <gazebo>
      <plugin
        filename="gz-sim-thruster-system"
        name="gz::sim::systems::Thruster">
        <namespace>rexrov</namespace>
        <joint_name>${joint_name}</joint_name>
        <fluid_density>1000.0</fluid_density>
        <thrust_coefficient>0.00031</thrust_coefficient>
        <velocity_control>true</velocity_control>
        <use_angvel_cmd>false</use_angvel_cmd>
      </plugin>
    </gazebo>
  </xacro:macro>

  <xacro:thruster_plugin joint_name="thruster1_joint"/>
  <xacro:thruster_plugin joint_name="thruster2_joint"/>
  <xacro:thruster_plugin joint_name="thruster3_joint"/>
  <xacro:thruster_plugin joint_name="thruster4_joint"/>
  <xacro:thruster_plugin joint_name="thruster5_joint"/>
  <xacro:thruster_plugin joint_name="thruster6_joint"/>
  <xacro:thruster_plugin joint_name="thruster7_joint"/>
  <xacro:thruster_plugin joint_name="thruster8_joint"/>

</robot>